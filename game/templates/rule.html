{% load staticfiles %}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Complex Lab</title>
<link rel="stylesheet" href="static/game/css/reveal.css">
<link rel="stylesheet" href="static/game/css/default.css" id="theme">
<style type="text/css">
	.left{
		width: 50%;
		float: left;
	}
	.right{
		width: 50%;
		float: right;
	}
	
</style>
<!--[if lt IE 9]>
<script src="js/html5shiv.js"></script>
<![endif]-->
</head>
<body>
<div class="reveal">
  <div class="slides" >
    <section>
      <h1>囚徒困境游戏</h1>
      <h3>Complex Lab</h3>
    </section>
    <section   data-transition="linear"data-background-transition="slide">
      <h2>游戏规则</h2>
      <div class='left'>
      	<font style="  font-size: 20px;">每一轮游戏中，您和您的对手需要在“合作”与“背叛”两个策略中进行选择。双方选择完成后，系统将根据右方的支付矩阵计算你们的收益． </br></br>
			因此，一共有以下四种可能的结果：</br>
			１.　您的选择：合作；  对手的选择：合作；</br>
			　   您的得分：0.3 ； 对手的得分： 0.3； </br> </br>
			２.　您的选择：合作；  对手的选择：背叛；</br>
			　   您的得分：0.0；  对手的得分： 0.5； </br> </br>
			３.　您的选择：背叛；  对手的选择：合作；</br>
			　   您的得分：0.5；  对手的得分： 0.0； </br> </br>
			４.　您的选择：背叛；  对手的选择：背叛；</br>
			　   您的得分：0.1；  对手的得分： 0.1； </br> </br>

	游戏将在有限轮之后结束。届时，您的分数会与历史上其他玩家进行比较并存入排行榜中，排行结果将向您展示。</br>
	成绩优异者将获得我们的奖品。
</font>
      </div>
      <div class='right' >
		<img src="static/game/images/PayoffMatrix2.png">
      </div>
    </section>
    <section style='font-size: 25px;'>
    	<h2>问券调查</h2>
    	
    		
<!--    	<h4>温馨提示：如果回答过程中遇到问题，可跳转到前一页参考游戏规则</h4> -->
    	
    	<div class='right' >
		<img src="static/game/images/PayoffMatrix2.png">
    	</div>
    	<div class="panel-body news left" id= 'ques' style='font-size: 25px;'>
    		<p>请根据上一页的游戏规则和右方的支付矩阵，正确回答下列四个问题．</p>
			{% block content %}
	    
	    	<ul>
		        {% for q in questions %}
		        <li>
			        {{q.description|safe}}
					<label><input type="radio" id="A" name="radiobutton{{q.name}}" value="1"><span>{{q.selectA}}</span></label>
		    		<label><input type="radio" id="B" name="radiobutton{{q.name}}" value="2"><span>{{q.selectB}}</span></label>
					<label><input type="radio" id="C" name="radiobutton{{q.name}}" value="3"><span>{{q.selectC}}</span></label>
		    		<label><input type="radio" id="D" name="radiobutton{{q.name}}" value="4"><span>{{q.selectD}}</span></label>
		        </li>
		        {% endfor %}
	    	</ul>

			{% endblock %}
			<input type='button' class="btn btn-large btn-primary" onclick="uploadAnswer()" value="提交"/>
		</div>
    </section>

    <section>
   <!--<link href="http://libs.baidu.com/bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet">
   <script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
   <script src="http://libs.baidu.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>-->
   <link href="static/game/css/bootstrap.min.css" rel="stylesheet">
   <script src="static/game/js/jquery.min.js"></script>
   <script src="static/game/js/bootstrap.min.js"></script>
		<h3>为了我们后期跟进联系，请留下您的个人信息与联系方式：</h3>

		<div style="padding: 100px 100px 10px;">
		   <form id='userInfo' class="bs-example bs-example-form" role="form" method='post' action="/getInitInfo">
		   	{% csrf_token %} 
		      <div class="input-group input-group-lg">
		         <span class="input-group-addon">姓名</span>
		         <input id='name' name='name' type="text" class="form-control" placeholder="Name">
		      </div><br>

		      <div  class="input-group input-group-lg">
		         性别
		         <select id='sex' name='sex'>
		         	<option></option>
		         	<option>男</option>
		         	<option>女</option>
		         </select>
		      </div><br>

		      <div  class="input-group input-group-lg">
		          年龄
		         <select id='age' name='age'>
		         	<option>0</option>
		         	<option>15</option>
		         	<option>16</option>
		         	<option>17</option>
		         	<option>18</option>
		         	<option>19</option>
		         	<option>20</option>
		         	<option>21</option>
		         	<option>22</option>
		         	<option>23</option>
		         	<option>24</option>
		         	<option>25</option>
		         	<option>26</option>
		         	<option>27</option>
		         	<option>28</option>
		         	<option>29</option>
		         	<option>30</option>
		         	<option>31</option>
		         	<option>32</option>
		         	<option>33</option>
		         	<option>34</option>
		         	<option>35</option>
		         	<option>36</option>
		         	<option>37</option>
		         	<option>38</option>
		         	<option>39</option>
		         	<option>40</option>
		         	<option>41</option>
		         	<option>42</option>
		         	<option>43</option>
		         	<option>44</option>
		         	<option>45</option>
		         	<option>46</option>
		         	<option>47</option>
		         	<option>48</option>
		         	<option>49</option>
		         	<option>50</option>
		         	<option>51</option>
		         	<option>52</option>
		         	<option>53</option>
		         	<option>54</option>
		         	<option>55</option>
		         	<option>56</option>
		         	<option>57</option>
		         	<option>58</option>
		         	<option>59</option>
		         	<option>60</option>
		         	<option>61</option>
		         	<option>62</option>
		         	<option>63</option>
		         	<option>64</option>
		         	<option>65</option>
		         	<option>66</option>
		         	<option>67</option>
		         	<option>68</option>
		         	<option>69</option>
		         	<option>70</option>
		         	<option>71</option>
		         	<option>72</option>
		         	<option>73</option>
		         	<option>74</option>
		         	<option>75</option>
		         	<option>76</option>
		         	<option>77</option>
		         	<option>78</option>
		         	<option>79</option>
		         	<option>80</option>
		         	<option>81</option>
		         	<option>82</option>
		         	<option>83</option>
		         	<option>84</option>
		         	<option>85</option>
		         	<option>86</option>
		         	<option>87</option>
		         	<option>88</option>
		         	<option>89</option>
		         </select>
		      </div>
		  </br>
		      <div class="input-group input-group-lg">
		         <span class="input-group-addon">邮箱</span>
		         <input id='email' name='email'  type="text" class="form-control" placeholder="email">
		      </div>
		  </br>
		       <button type="button" class="btn btn-primary btn-lg" onclick="check()">
			      确认
			   </button>
		   </form>
		</div>
    </section>
  </div>
</div>
<script src="static/game/js/head.min.js"></script>
<script src="static/game/js/reveal.min.js"></script>
<script>
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'static/game/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'static/game/js/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'static/game/js/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'static/game/js/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'static/game/js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'static/game/js/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});
	function check(){
		var name = $("#name")[0].value
		var age = $("#age")[0].value
		var sex = $("#sex")[0].value
		var email = $("#email")[0].value
		var re= /\w@\w*\.\w/
		if (name== "" || sex == "" || email=="" || age == '0'){
			alert("请完成信息填写!");
		}else if(!re.test(email)){
			alert("请检查邮箱格式!");
		}else{
			$.ajax({
				url: "/getAnswerAllCorrect",
				type: "GET",
				dataType: 'json',
				success:function (result) {
					if (result['allCorrectFlag'] == 0){
						alert("请先正确回答上一页的问题!");
					}else{
						userInfo.submit();
					}
				},
				error:function(result){
				}
			});
			//userInfo.submit();
		}

	}

function uploadAnswer(){
	var answers = $("#ques input");

	var allNum = {{questionNumber}}
	dat = {
		'answer' : [],
		'qAnswer' : ""
	}

	for(var i=0;i<answers.length;i++){
		if(answers[i].checked){
			dat['answer'].push(i % 4+1)
		}
	}


	if (dat['answer'].length != allNum){
		alert("请先完成问卷!~~");
		return;
	}else{
		dat['qAnswer'] = ""
		for (var i =0; i< allNum; i++){
			if (i == 0){
				dat['qAnswer'] += dat['answer'][i].toString()
			}else{
				dat['qAnswer'] += ','+dat['answer'][i].toString()
			}
		}
	}
	$.ajax({
		url: "/getAnswer",
		type: "GET",
		dataType: 'json',
		data: dat,
		success:function (result) {
			console.log(result);
			correctNum = 0
			answerValue = ""
			for(var i = 0; i < allNum; i++){
				if (result[i].correct == 1){
					correctNum += 1;					
				}else{
					if (result[i].correctAnswer == 1){
						correctChar = 'A';
					}else if (result[i].correctAnswer == 2){
						correctChar = 'B';
					}else if (result[i].correctAnswer == 3){
						correctChar = 'C';
					}else if (result[i].correctAnswer == 4){
						correctChar = 'D';
					}
					answerValue += "您问题"+(i+1).toString()+" 回答错误,请重新回答!\n"
				}

			}
			if (answerValue == ""){
				alert("恭喜你，全部答对!!");
				window.location.href = "/rule#/3";
			}else{
				alert(answerValue)
			}
			score = correctNum/allNum ;
			answerValue = "<h2> 你得到了 "+(score*100).toFixed(2).toString()+"/100 分</h2>" + answerValue
			$("#ans")[0].innerHTML = answerValue;

			$("#answer")[0].style.display = ""
		},
		error:function(result){
		}
	});

}
</script>
</body>
</html>
